

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pypsi.cmdline &#8212; pypsi 1.4.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pypsi 1.4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pypsi.cmdline</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (c) 2015, Adam Meily &lt;meily.adam@gmail.com&gt;</span>
<span class="c1"># Pypsi - https://github.com/ameily/pypsi</span>
<span class="c1">#</span>
<span class="c1"># Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="c1"># purpose with or without fee is hereby granted, provided that the above</span>
<span class="c1"># copyright notice and this permission notice appear in all copies.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="c1"># WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="c1"># MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="c1"># ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="c1"># WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="c1"># ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="c1"># OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="c1">#</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Classes used for parsing user input.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pypsi.utils</span> <span class="k">import</span> <span class="n">safe_open</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;StringToken&#39;</span><span class="p">,</span> <span class="s1">&#39;OperatorToken&#39;</span><span class="p">,</span> <span class="s1">&#39;WhitespaceToken&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IORedirectionError&#39;</span><span class="p">,</span> <span class="s1">&#39;StatementParser&#39;</span><span class="p">,</span> <span class="s1">&#39;StatementSyntaxError&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CommandNotFoundError&#39;</span><span class="p">,</span> <span class="s1">&#39;CommandInvocation&#39;</span><span class="p">,</span> <span class="s1">&#39;Expression&#39;</span><span class="p">,</span> <span class="s1">&#39;Statement&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TrailingEscapeError&#39;</span>
<span class="p">)</span>


<span class="c1">#: The token accepts more characters.</span>
<span class="n">TokenContinue</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">#: The token does not accept the current chracter.</span>
<span class="n">TokenEnd</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">#: The token is finished and the current chracter should not be processed</span>
<span class="c1">#: again.</span>
<span class="n">TokenTerm</span> <span class="o">=</span> <span class="mi">2</span>


<div class="viewcode-block" id="Token"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Token">[docs]</a><span class="k">class</span> <span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Base class for all tokens.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param int index: the starting index of this token</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="WhitespaceToken"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.WhitespaceToken">[docs]</a><span class="k">class</span> <span class="nc">WhitespaceToken</span><span class="p">(</span><span class="n">Token</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Whitespace token that can contain any number of whitespace characters.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WhitespaceToken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">c</span>

<div class="viewcode-block" id="WhitespaceToken.add_char"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.WhitespaceToken.add_char">[docs]</a>    <span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a character to this token.</span>

<span class="sd">        :param str c: the current character</span>
<span class="sd">        :returns int: TokenEnd or TokenContinue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">TokenContinue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TokenEnd</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;WhitespaceToken( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">WhitespaceToken</span><span class="p">)</span></div>


<div class="viewcode-block" id="StringToken"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StringToken">[docs]</a><span class="k">class</span> <span class="nc">StringToken</span><span class="p">(</span><span class="n">Token</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A string token. This token may be bound by matching quotes and/or contain</span>
<span class="sd">    escaped whitespace characters.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param str c: the current string or character</span>
<span class="sd">        :param str quote: the surrounding quotes, `None` if there isn&#39;t any</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StringToken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">quote</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">escape_char</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>

<div class="viewcode-block" id="StringToken.add_char"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StringToken.add_char">[docs]</a>    <span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a character to this token.</span>

<span class="sd">        :param str c: the current character</span>
<span class="sd">        :returns int: TokenEnd or TokenContinue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenContinue</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">OperatorToken</span><span class="o">.</span><span class="n">Operators</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenTerm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape_char</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenEnd</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenEnd</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>

        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="k">def</span> <span class="nf">combine_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">open_quote</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">escape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">quote</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;String( </span><span class="si">{quote}{text}{quote}</span><span class="s2">, </span><span class="si">{open_quote}</span><span class="s2">, </span><span class="si">{escape}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">quote</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="n">open_quote</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span><span class="p">,</span>
            <span class="n">escape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">escape</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">quote</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">open_quote</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">escape</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="OperatorToken"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.OperatorToken">[docs]</a><span class="k">class</span> <span class="nc">OperatorToken</span><span class="p">(</span><span class="n">Token</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An operator token. An operator can consist of one or more repetitions of</span>
<span class="sd">    the same operator character. For example, the string &quot;&gt;&gt;&quot; would be parsed</span>
<span class="sd">    as one `OperatorToken`, whereas the string &quot;&lt;&gt;&quot; would be parsed as two</span>
<span class="sd">    separate `OperatorToken` objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#: Valid operator characters</span>
    <span class="n">Operators</span> <span class="o">=</span> <span class="s1">&#39;&lt;&gt;|&amp;;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param str operator: the operator</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OperatorToken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span>

<div class="viewcode-block" id="OperatorToken.add_char"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.OperatorToken.add_char">[docs]</a>    <span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a character to this token.</span>

<span class="sd">        :param str c: the current character</span>
<span class="sd">        :returns int: TokenEnd or TokenContinue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">TokenContinue</span>
        <span class="k">return</span> <span class="n">TokenEnd</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;OperatorToken( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_chain_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">operator</span>
        <span class="p">)</span></div>


<span class="k">class</span> <span class="nc">IORedirectionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>


<div class="viewcode-block" id="CommandNotFoundError"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandNotFoundError">[docs]</a><span class="k">class</span> <span class="nc">CommandNotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The specified command does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1">#: the command name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;: command not found&quot;</span></div>


<div class="viewcode-block" id="Statement"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement">[docs]</a><span class="k">class</span> <span class="nc">Statement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A parsed statement containing a list of :class:`CommandInvocation`</span>
<span class="sd">    instances.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invokes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param list[CommandInvocation] invokes: list of command invocations</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invokes</span> <span class="o">=</span> <span class="n">invokes</span> <span class="ow">or</span> <span class="p">[]</span>

<div class="viewcode-block" id="Statement.append"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoke</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Append a new command invocation.</span>

<span class="sd">        :param CommandInvocation invoke: parsed command invocation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invokes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">invoke</span><span class="p">)</span></div>

<div class="viewcode-block" id="Statement.__iter__"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns: an iterator for the :class:`CommandInvocation` instances</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invokes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns bool: :const:`True` if there is at least 1 parsed command</span>
<span class="sd">            invocation, :const:`False` otherwise</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invokes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<div class="viewcode-block" id="Statement.__len__"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement.__len__">[docs]</a>    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns int: the number of command invocations</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invokes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Statement</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">invokes</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">invokes</span></div>


<div class="viewcode-block" id="CommandInvocation"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation">[docs]</a><span class="k">class</span> <span class="nc">CommandInvocation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An invocation of a command.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">chain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#: Command name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1">#: List of command arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1">#: stdout redirection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
        <span class="c1">#: stderr redirection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">stderr</span>
        <span class="c1">#: stderr redirection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">stdin</span>
        <span class="c1">#: The chain operator, if any is specified: &amp;&amp;, ||, |, ;.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
        <span class="c1">#: The resolved pypsi command (:class:`~pypsi.core.Command`)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: The fallback command to use if :attr:`cmd` is :const:`None`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fallback_cmd</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CommandInvocation</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">args</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">stdout</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">stderr</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">stdin</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">chain</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cmd</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fallback_cmd</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">fallback_cmd</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> </span><span class="si">{args}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; &gt;&gt; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; &gt; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; &lt; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span>

        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="CommandInvocation.setup"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shell</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieve the Pypsi command to execute and setup the streams for stdout,</span>
<span class="sd">        stderr, and stdin depending on whether I/O redirection is being</span>
<span class="sd">        performed.</span>

<span class="sd">        :raises CommandNotFoundError: command specified does not exist</span>
<span class="sd">        :raises IORedirectionError: I/O redirection error occurred</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">shell</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">shell</span><span class="o">.</span><span class="n">fallback_cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fallback_cmd</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">fallback_cmd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CommandNotFoundError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_streams</span><span class="p">()</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="CommandInvocation.get_output"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.get_output">[docs]</a>    <span class="k">def</span> <span class="nf">get_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Open an output stream, if specified.</span>

<span class="sd">        :returns file: the stream opened for writting if specified, otherwise</span>
<span class="sd">            const:`None`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># output is a tuple of (path, mode)</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">output</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># output is a path</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># output is either None or an existing open stream</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="CommandInvocation.get_input"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.get_input">[docs]</a>    <span class="k">def</span> <span class="nf">get_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Open an input stream, if specified.</span>

<span class="sd">        :returns file: the stream opened for reading if specified, otherwise</span>
<span class="sd">            :const:`None`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="CommandInvocation.get_stream"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.get_stream">[docs]</a>    <span class="k">def</span> <span class="nf">get_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Open a file path.</span>

<span class="sd">        :param str path: file path</span>
<span class="sd">        :param str mode: file open mode</span>
<span class="sd">        :param bool safe: whether to use :meth:`pypsi.util.safe_open` instead</span>
<span class="sd">            of the standard :meth:`open` method.</span>

<span class="sd">        :raises IORedirectionError: stream could not be opened</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">func</span> <span class="o">=</span> <span class="n">safe_open</span> <span class="k">if</span> <span class="n">safe</span> <span class="k">else</span> <span class="nb">open</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IORedirectionError</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IORedirectionError</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fp</span></div>

<div class="viewcode-block" id="CommandInvocation.close_streams"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.close_streams">[docs]</a>    <span class="k">def</span> <span class="nf">close_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Close all streams that were opened.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fp</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fp</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="CommandInvocation.setup_io"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.setup_io">[docs]</a>    <span class="k">def</span> <span class="nf">setup_io</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Setup stdout, stderr, and stdin by proxying the thread local streams.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">_proxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">_proxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">_proxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandInvocation.cleanup_io"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.cleanup_io">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_io</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Close proxied streams and unproxy them.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">close_streams</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">_unproxy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">_unproxy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">_unproxy</span><span class="p">()</span></div>

<div class="viewcode-block" id="CommandInvocation.chain_and"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.chain_and">[docs]</a>    <span class="k">def</span> <span class="nf">chain_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns: :const:`True` if the chain operator is AND (&amp;&amp;)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="s1">&#39;&amp;&amp;&#39;</span></div>

<div class="viewcode-block" id="CommandInvocation.chain_or"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.chain_or">[docs]</a>    <span class="k">def</span> <span class="nf">chain_or</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns: :const:`True` if the chain operator is OR (||)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="s1">&#39;||&#39;</span></div>

<div class="viewcode-block" id="CommandInvocation.chain_uncond"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.chain_uncond">[docs]</a>    <span class="k">def</span> <span class="nf">chain_uncond</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns: :const:`True` if the chain operator is UNCONDITIONAL (;)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span></div>

<div class="viewcode-block" id="CommandInvocation.chain_pipe"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.chain_pipe">[docs]</a>    <span class="k">def</span> <span class="nf">chain_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns: :const:`True` if the chain operator is PIPE (|)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="s1">&#39;|&#39;</span></div>

<div class="viewcode-block" id="CommandInvocation.__call__"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shell</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Invoke the command by proxying streams, running the command, and</span>
<span class="sd">        cleaning the resetting streams.</span>

<span class="sd">        :returns: the commnd&#39;s return code.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_io</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_cmd</span><span class="p">:</span>
                <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_cmd</span><span class="o">.</span><span class="n">fallback</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_io</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rc</span></div>

<div class="viewcode-block" id="CommandInvocation.should_continue"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandInvocation.should_continue">[docs]</a>    <span class="k">def</span> <span class="nf">should_continue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prev_rc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns: whether this invocation is chained and, using the previous</span>
<span class="sd">            invocation&#39;s return code, determine if the next command in the</span>
<span class="sd">            chain should be executed.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chain_uncond</span><span class="p">()</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_or</span><span class="p">()</span> <span class="ow">and</span> <span class="n">prev_rc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_and</span><span class="p">()</span> <span class="ow">and</span> <span class="n">prev_rc</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="StatementSyntaxError"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementSyntaxError">[docs]</a><span class="k">class</span> <span class="nc">StatementSyntaxError</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Invalid statement syntax was entered.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param str message: error message</span>
<span class="sd">        :param int index: index in the statement that caused the error</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;syntax error at </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">UnclosedQuotationError</span><span class="p">(</span><span class="n">StatementSyntaxError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The final token contains an unclosed quotation.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UnclosedQuotationError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;unclosed quotation&quot;</span><span class="p">,</span>
                                                     <span class="n">index</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TrailingEscapeError</span><span class="p">(</span><span class="n">StatementSyntaxError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The final token ends with an escape character.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TrailingEscapeError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;trailing escape character&quot;</span><span class="p">,</span>
                                                  <span class="n">index</span><span class="p">)</span>


<div class="viewcode-block" id="StatementParser"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser">[docs]</a><span class="k">class</span> <span class="nc">StatementParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parses raw user input into a :class:`Statement`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="StatementParser.process"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Process a single character of input.</span>

<span class="sd">        :param int index: current character index</span>
<span class="sd">        :param str c: current character</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">add_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">TokenEnd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">TokenTerm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">WhitespaceToken</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">OperatorToken</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">StringToken</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span></div>

<div class="viewcode-block" id="StatementParser.tokenize"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.tokenize">[docs]</a>    <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Transform a `str` into a `list` of :class:`Token` objects.</span>

<span class="sd">        :param str line: the line of text to tokenize</span>
<span class="sd">        :returns: `list` of :class:`Token` objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">multiline</span><span class="p">:</span>
                        <span class="c1"># The last character in the input was an escape and the</span>
                        <span class="c1"># shell supports multiline input. Switch back to the</span>
                        <span class="c1"># shell to allow further input.</span>
                        <span class="k">raise</span> <span class="n">TrailingEscapeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">escape_char</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">open_quote</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">multiline</span><span class="p">:</span>
                        <span class="c1"># The last token is an unclosed quotation and the shell</span>
                        <span class="c1"># supports multiline line input. Switch back to the</span>
                        <span class="c1"># shell to allow further input.</span>
                        <span class="c1">#</span>
                        <span class="c1"># We add a newline to the last text token since we are</span>
                        <span class="c1"># in a quoted string.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="k">raise</span> <span class="n">UnclosedQuotationError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span></div>

<div class="viewcode-block" id="StatementParser.clean_escapes"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.clean_escapes">[docs]</a>    <span class="k">def</span> <span class="nf">clean_escapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove all escape sequences.</span>

<span class="sd">        :param list tokens: :class:`Token` objects to remove escape sequences</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">escape_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">escape_char</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">escape_char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">quote</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">escape</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">escape</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
                    <span class="n">escape</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">escape_char</span><span class="p">:</span>
                    <span class="n">escape</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>

            <span class="k">if</span> <span class="n">escape</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="n">escape_char</span>

            <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span></div>

<div class="viewcode-block" id="StatementParser.condense"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.condense">[docs]</a>    <span class="k">def</span> <span class="nf">condense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Condenses sequential like :class:`Token` objects into a single</span>
<span class="sd">        :class:`Token` of the same type. For example, two sequential</span>
<span class="sd">        :class:`StringToken` objects will be concatenated into a single</span>
<span class="sd">        :class:`StringToken`.</span>

<span class="sd">        :param list tokens: :class:`Token` objects to condense</span>
<span class="sd">        :returns: condensed `list` of :class:`Token` objects</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">condensed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">quote</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">preserve_quotes</span><span class="p">):</span>
                    <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{q}{t}{q}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">quote</span><span class="p">,</span>
                                                    <span class="n">t</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                    <span class="n">prev</span><span class="o">.</span><span class="n">combine_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
                    <span class="n">token</span> <span class="o">=</span> <span class="n">prev</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">condensed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">WhitespaceToken</span><span class="p">):</span>
                <span class="n">condensed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">token</span>

        <span class="k">return</span> <span class="n">condensed</span></div>

<div class="viewcode-block" id="StatementParser.build"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a :class:`Statement` object from tokenized input and statement</span>
<span class="sd">        context. This method will first remove all remaining escape sequences</span>
<span class="sd">        and then :meth:`condense` all the tokens before building the statement.</span>

<span class="sd">        :param list tokens: list of :class:`Token` objects to process as a</span>
<span class="sd">            statement</span>
<span class="sd">        :raises: :class:`StatementSyntaxError` on error</span>
<span class="sd">        :returns: (:class:`Statement`) the parsed statement</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">statement</span> <span class="o">=</span> <span class="n">Statement</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_escapes</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condense</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">):</span>
                            <span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                <span class="s1">&#39;w&#39;</span> <span class="k">if</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="k">else</span> <span class="s1">&#39;a&#39;</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                            <span class="n">cmd</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;unexpected token: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                            <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                    <span class="n">cmd</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">):</span>
                    <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;||&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">):</span>
                        <span class="n">cmd</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;|&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;unexpected token: </span><span class="si">{}</span><span class="s2">: duplicate output &quot;</span>
                                   <span class="s2">&quot;redirection is invalid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>

                        <span class="n">cmd</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;unexpected token: </span><span class="si">{}</span><span class="s2">: duplicate output &quot;</span>
                                   <span class="s2">&quot;redirection is invalid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdin</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
                                         <span class="n">statement</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="s1">&#39;|&#39;</span><span class="p">):</span>
                            <span class="c1"># The previous command in was a pipe, so input</span>
                            <span class="c1"># redirection is not supported.</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;unexpected token: </span><span class="si">{}</span><span class="s2"> duplicate input &quot;</span>
                                   <span class="s2">&quot;redirection is invalid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;unknown operator: &quot;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
                            <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                        <span class="n">cmd</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">CommandInvocation</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">WhitespaceToken</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;unexpected token: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                    <span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">token</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">prev</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;unexpected token: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prev</span><span class="p">)),</span>
                <span class="n">index</span><span class="o">=</span><span class="n">prev</span><span class="o">.</span><span class="n">index</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">statement</span></div></div>


<div class="viewcode-block" id="Expression"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Expression">[docs]</a><span class="k">class</span> <span class="nc">Expression</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Holds a string-based expression in the form of ``operand operator value``.</span>
<span class="sd">    This class makes parsing expressions that may be in a single string or a</span>
<span class="sd">    list of strings. For example, the :class:`pypsi.plugins.VarCommand` command</span>
<span class="sd">    accepts input in the form of: ``name = value``. This class allows for the</span>
<span class="sd">    user to input any of the following lines and the same Expression object</span>
<span class="sd">    would be created, regardless of how the input lines are tokenized:</span>

<span class="sd">    - ``some_var = 2`` =&gt; ``[&#39;some_var&#39;, &#39;=&#39;, &#39;2&#39;]``</span>
<span class="sd">    - ``some_var= 2`` =&gt; ``[&#39;some_var=&#39;, &#39;2&#39;]``</span>
<span class="sd">    - ``some_var =2`` =&gt; ``[&#39;some_var&#39;, &#39;=2&#39;]``</span>
<span class="sd">    - ``some_var=2`` =&gt; ``[&#39;some_var=2&#39;]``</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">Operators</span> <span class="o">=</span> <span class="s1">&#39;-+=/*&#39;</span>
    <span class="n">Whitespace</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operand</span> <span class="o">=</span> <span class="n">operand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Expression</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operand</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">operand</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">operator</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Expression.parse"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Expression.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create an Expression from a list of strings.</span>

<span class="sd">        :param list args: arguments</span>
<span class="sd">        :returns: a tuple of ``(remaining, expression)``, where ``remaining``</span>
<span class="sd">            is the list of remaining string arguments of ``args`` after parsing</span>
<span class="sd">            has completed, and ``expression`` in the parsed</span>
<span class="sd">            :class:`Expression`, or :const:`None` if the expression is invalid.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;operand&#39;</span>
        <span class="n">operand</span> <span class="o">=</span> <span class="n">operator</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;operand&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Whitespace</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operand</span><span class="p">:</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;operator&#39;</span>
                    <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Operators</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;operator&#39;</span>
                        <span class="n">operator</span> <span class="o">=</span> <span class="n">c</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">operand</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">operand</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;operator&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Operators</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">operator</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">operator</span> <span class="o">+=</span> <span class="n">c</span>
                    <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Whitespace</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operator</span><span class="p">:</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
                            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Whitespace</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="n">remaining</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">operator</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">remaining</span><span class="p">,</span> <span class="n">Expression</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pypsi 1.4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Adam Meily.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.
    </div>
  </body>
</html>